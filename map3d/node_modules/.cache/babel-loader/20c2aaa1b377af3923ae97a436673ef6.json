{"ast":null,"code":"function _instanceof(left, right) {\n  return null != right && \"undefined\" != typeof Symbol && right[Symbol.hasInstance] ? right[Symbol.hasInstance](left) : left instanceof right;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!_instanceof(instance, Constructor)) throw new TypeError(\"Cannot call a class as a function\");\n}\n\nfunction _defineProperties(target, props) {\n  for (var descriptor, i = 0; i < props.length; i++) {\n    descriptor = props[i], descriptor.enumerable = descriptor.enumerable || !1, descriptor.configurable = !0, \"value\" in descriptor && (descriptor.writable = !0), Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  return protoProps && _defineProperties(Constructor.prototype, protoProps), staticProps && _defineProperties(Constructor, staticProps), Constructor;\n}\n\nimport assert from \"./assert\";\nimport { LinearInterpolator } from \"./transition\";\nimport MapState from \"./map-state\";\n\nvar noop = function noop() {};\n\nexport var TRANSITION_EVENTS = {\n  BREAK: 1,\n  SNAP_TO_END: 2,\n  IGNORE: 3\n};\n\nvar DEFAULT_PROPS = {\n  transitionDuration: 0,\n  transitionEasing: function transitionEasing(t) {\n    return t;\n  },\n  transitionInterpolator: new LinearInterpolator(),\n  transitionInterruption: TRANSITION_EVENTS.BREAK,\n  onTransitionStart: noop,\n  onTransitionInterrupt: noop,\n  onTransitionEnd: noop\n},\n    DEFAULT_STATE = {\n  animation: null,\n  propsInTransition: null,\n  startProps: null,\n  endProps: null\n},\n    TransitionManager = function () {\n  function TransitionManager(props) {\n    _classCallCheck(this, TransitionManager), this.props = props, this.state = DEFAULT_STATE, this._onTransitionFrame = this._onTransitionFrame.bind(this);\n  }\n\n  return _createClass(TransitionManager, [{\n    key: \"getViewportInTransition\",\n    value: function getViewportInTransition() {\n      return this.state.propsInTransition;\n    }\n  }, {\n    key: \"processViewportChange\",\n    value: function processViewportChange(nextProps) {\n      var transitionTriggered = !1,\n          currentProps = this.props;\n      if (this.props = nextProps, this._shouldIgnoreViewportChange(currentProps, nextProps)) return transitionTriggered;\n\n      var isTransitionInProgress = this._isTransitionInProgress();\n\n      if (this._isTransitionEnabled(nextProps)) {\n        var startProps = Object.assign({}, currentProps, this.state.interruption === TRANSITION_EVENTS.SNAP_TO_END ? this.state.endProps : this.state.propsInTransition);\n        isTransitionInProgress && currentProps.onTransitionInterrupt(), nextProps.onTransitionStart(), this._triggerTransition(startProps, nextProps), transitionTriggered = !0;\n      } else isTransitionInProgress && (currentProps.onTransitionInterrupt(), this._endTransition());\n\n      return transitionTriggered;\n    }\n  }, {\n    key: \"_isTransitionInProgress\",\n    value: function _isTransitionInProgress() {\n      return !!this.state.propsInTransition;\n    }\n  }, {\n    key: \"_isTransitionEnabled\",\n    value: function _isTransitionEnabled(props) {\n      return 0 < props.transitionDuration && !!props.transitionInterpolator;\n    }\n  }, {\n    key: \"_isUpdateDueToCurrentTransition\",\n    value: function _isUpdateDueToCurrentTransition(props) {\n      return !!this.state.propsInTransition && this.state.interpolator.arePropsEqual(props, this.state.propsInTransition);\n    }\n  }, {\n    key: \"_shouldIgnoreViewportChange\",\n    value: function _shouldIgnoreViewportChange(currentProps, nextProps) {\n      return this._isTransitionInProgress() ? this.state.interruption === TRANSITION_EVENTS.IGNORE || this._isUpdateDueToCurrentTransition(nextProps) : !this._isTransitionEnabled(nextProps) || nextProps.transitionInterpolator.arePropsEqual(currentProps, nextProps);\n    }\n  }, {\n    key: \"_triggerTransition\",\n    value: function _triggerTransition(startProps, endProps) {\n      assert(this._isTransitionEnabled(endProps), \"Transition is not enabled\"), cancelAnimationFrame(this.state.animation);\n      var initialProps = endProps.transitionInterpolator.initializeProps(startProps, endProps);\n      this.state = {\n        duration: endProps.transitionDuration,\n        easing: endProps.transitionEasing,\n        interpolator: endProps.transitionInterpolator,\n        interruption: endProps.transitionInterruption,\n        startTime: Date.now(),\n        startProps: initialProps.start,\n        endProps: initialProps.end,\n        animation: null,\n        propsInTransition: {}\n      }, this._onTransitionFrame();\n    }\n  }, {\n    key: \"_onTransitionFrame\",\n    value: function _onTransitionFrame() {\n      this.state.animation = requestAnimationFrame(this._onTransitionFrame), this._updateViewport();\n    }\n  }, {\n    key: \"_endTransition\",\n    value: function _endTransition() {\n      cancelAnimationFrame(this.state.animation), this.state = DEFAULT_STATE;\n    }\n  }, {\n    key: \"_updateViewport\",\n    value: function _updateViewport() {\n      var currentTime = Date.now(),\n          _this$state = this.state,\n          startTime = _this$state.startTime,\n          duration = _this$state.duration,\n          easing = _this$state.easing,\n          interpolator = _this$state.interpolator,\n          startProps = _this$state.startProps,\n          endProps = _this$state.endProps,\n          shouldEnd = !1,\n          t = (currentTime - startTime) / duration;\n      1 <= t && (t = 1, shouldEnd = !0), t = easing(t);\n      var viewport = interpolator.interpolateProps(startProps, endProps, t),\n          mapState = new MapState(Object.assign({}, this.props, viewport));\n      this.state.propsInTransition = mapState.getViewportProps();\n      var onViewportChange = this.props.onViewportChange || this.props.onChangeViewport;\n      onViewportChange && onViewportChange(this.state.propsInTransition), this.props.onViewStateChange && this.props.onViewStateChange({\n        viewState: this.state.propsInTransition\n      }), shouldEnd && (this._endTransition(), this.props.onTransitionEnd());\n    }\n  }]), TransitionManager;\n}();\n\nexport { TransitionManager as default };\nTransitionManager.defaultProps = DEFAULT_PROPS;","map":null,"metadata":{},"sourceType":"module"}